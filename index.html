<html>
<head>
  <base href="https://skazdime.github.io/SKAZMYO-TRACKER/">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#121212">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Skazius Strength Tracker App</title>
  <link rel="manifest" href="/SKAZMYO-TRACKER/manifest.json">
  <style>
    
  body {
    font-family: 'Roboto', sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 10px;
    background-color: #121212;
    color: #e0e0e0;
    -webkit-tap-highlight-color: transparent;
  }
  .container {
    max-width: 100%;
    margin: 0 auto;
    background-color: #1e1e1e;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }
  .logo {
    display: block;
    margin: 0 auto 15px;
    max-width: 100px;
    height: auto;
  }
  h1, h2 {
    color: #0892fc;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-size: 1.5em;
    margin-bottom: 5px;
  }
  h3, h4, h5 {
    color: #9edf4a;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-size: small;
    margin-bottom: 15px;
  }    
  form {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
  }
  input, button, select {
    padding: 12px;
    border: 1px solid #333;
    border-radius: 4px;
    background-color: #2c2c2c;
    color: #e0e0e0;
    font-size: 16px;
    -webkit-appearance: none;
  }
  input[type="checkbox"] {
    -webkit-appearance: checkbox;
    -moz-appearance: checkbox;
    appearance: checkbox;
    width: auto;
    height: auto;
  }
  input:focus, select:focus {
    outline: none;
    border-color: #0892fc;
  }
  button {
    background-color: #0892fc;
    color: #b4fc57;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.1s;
    font-weight: bold;
    touch-action: manipulation;
  }
  button:hover, button:focus {
    background-color: #0775d1;
  }
  button:active {
    transform: translateY(1px);
  }
  .set-container {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 8px;
  }
  .set-container input {
    flex: 1;
  }
  .set-container input[type="text"] {
    flex: 2;
  }
  .remove-set {
    background-color: #cf6679;
    color: #ffffff;
    padding: 8px;
    font-size: 14px;
  }
  .remove-set:hover, .remove-set:focus {
    background-color: #b55464;
  }
  #add-set {
    background-color: #b4fc57;
    color: #121212;
  }
  #add-set:hover, #add-set:focus {
    background-color: #9edf4a;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    background-color: #2c2c2c;
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    padding: 12px 8px;
    text-align: left;
    border-bottom: 1px solid #444;
    font-size: 14px;
  }
  th {
    background-color: #333;
    color: #b4fc57;
    font-weight: bold;
    text-transform: uppercase;
  }
  tr:last-child td {
    border-bottom: none;
  }
  #export-btn {
    background-color: #b4fc57;
    color: #121212;
    margin-top: 10px;
  }
  #export-btn:hover, #export-btn:focus {
    background-color: #9edf4a;
  }
  #clear-all-btn {
    background-color: #e05151;
    color: #121212;
    margin-top: 10px;
  }
  #clear-all-btn:hover, #clear-all-btn:focus {
    background-color: #ff5c61;
  }  
  .time-container {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 8px;
  }
  .time-container input {
    flex: 1;
  }
  .superset-container {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-top: 8px;
    padding-left: 20px;
    border-left: 2px solid #0892fc;
  }
  .superset-container input {
    flex: 1;
  }
  .remove-superset {
    background-color: #cf6679;
    color: #ffffff;
    padding: 8px;
    font-size: 14px;
  }
  .remove-superset:hover, .remove-superset:focus {
    background-color: #b55464;
  }
  @media (max-width: 480px) {
    .set-container, .time-container {
      flex-direction: column;
      gap: 5px;
    }
    .set-container input, .set-container button,
    .time-container input {
      width: 100%;
    }
    .superset-container {
      flex-direction: column;
      gap: 5px;
    }
    .superset-container input, .superset-container button {
      width: 100%;
    }
    #timer-container {
  text-align: center;
  margin-top: 10px;
}

#timer-display {
  font-size: 2em; /* Adjust as needed */
  text-align: center
  color: #b4fc57;
  margin-bottom: 10px;
}

#start-timer-90, #start-timer-120 {
  background-color: #0892fc;
  color: #b4fc57;
  margin-right: 10px;
  padding: 10px;
  font-weight: bold;
  border-radius: 4px;
  cursor: pointer;
}

#start-timer-90:hover, #start-timer-120:hover {
  background-color: #0775d1;
}
    
     .footer {
       display: flex;
       justify-content: center;
       align-items: center; 
       position: sticky;
       padding: 5px;
       bottom: 0;
       width: 100%;
       height: 95px;
       background: rgb(55, 61, 55);
       color: white;
       }

  </style>
</head>
<body>
  <div class="container">
    <img src="skaz_green.png" alt="Stylized skull helmet logo in green and black" class="logo" width="100" height="100">
    <h1>Skazius Strength Tracker</h1>
    <h3>V.1.007</h3>
    <h5>&#169; Lewie Tenorio 2024</h5>
    <form id="exercise-form">
      <input type="date" id="date" required>
      <div class="time-container">
        <input type="time" id="start-time" required>
        <input type="time" id="end-time" required>
      </div>
      <h3>Today's Split</h3>
      <div id="split-container">
        <label><input type="checkbox" name="split" value="chest"> Chest</label>
        <label><input type="checkbox" name="split" value="back"> Back</label>
        <label><input type="checkbox" name="split" value="legs"> Legs</label>
        <br> 
        <label><input type="checkbox" name="split" value="shoulders"> Shoulders</label>
        <label><input type="checkbox" name="split" value="arms"> Arms</label>
      </div>
      <select id="exercise" required>
        <option value="">Select Exercise</option>
        <option value="Bench Press">Bench Press</option>
        <option value="Incline Bench Press">Incline Bench Press</option>
        <option value="Dumbell Press Flat">Dumbell Press</option>
        <option value="Incline Dumbell Press">Incline Dumbell Press</option>
        <option value="Pec Flies">Pec Flies</option>
        <option value="Overhead Press">Overhead Press</option>
        <option value="Cable Lateral Raise">Cable Lateral Raise</option>
        <option value="Dumbell Lateral Raise">Dumbell Lateral Raise</option>
        <option value="Cable Rear Delt Fly">Cable Rear Delt Fly</option>
        <option value="Rear Delt Fly Machine">Rear Delt Fly Machine</option>
        <option value="Barbell Row">Barbell Row</option>
        <option value="T-bar Row">T-bar Row</option>
        <option value="Chest Supported Row">Chest Supported Row</option>
        <option value="Cable Lat Pulldown">Cable Lat Pulldown</option>
        <option value="Seated Cable Row">Seated Cable Row</option>
        <option value="Barbell Arm Curls">Barbell Arm Curls</option>
        <option value="Cable Arm Curls">Cable Arm Curls</option>
        <option value="Dumbell Arm Curls">Dumbell Arm Curls</option>
        <option value="Tricep Extension (Cable)">Tricep Extension (Cable)</option>
        <option value="Tricep Extension (Seated Machine)">Tricep Extension (Seated Machine)</option>
        <option value="Cable Tricep Pushdown">Cable Tricep Pushdown</option>
        <option value="Wrist Curls">Wrist Curls</option>
        <option value="Squat">Squat</option>
        <option value="Hack Squat">Hack Squat</option>
        <option value="Leg Press Machine (LPM) ">Leg Press Machine (LPM)</option>
        <option value="Sissy Squat">Sissy Squat</option>
        <option value="Calf Raises">Calf Raises</option>
        <option value="Calf Raises (LPM)">Calf Raises (LPM)</option>
        <option value="Calf Raises (Standing Machine)">Calf Raises (Standing Machine)</option>
        <option value="Calf Raises (Dumbell S-LR)">Calf Raises (Dumbell S-LR)</option>
        <option value="Anterior Tibialis Raise">Anterior Tibialis Raise</option>
        <option value="Reverse Nordic">Reverse Nordic</option>
        <option value="Deadlift">Deadlift</option>
        <option value="other">Other (specify)</option>
      </select>
      <input type="text" id="custom-exercise" placeholder="Custom Exercise Name" class="hidden">
      <div id="sets-container"></div>
      <button type="button" id="add-set">Add Set</button>
      <button type="submit">Add Exercise</button>
    </form>
    <h2>Exercise Log</h2>
    <table id="exercise-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Exercise</th>
          <th>Sets</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="export-btn">Export to CSV</button>
    <button id="export-txt-btn">Export to TXT</button>
    <button id="clear-all-btn">Clear All</button>
  </div>

        <!-- Footer -->
      <div class="footer">
        <!-- Timer -->
        <div id="timer-container">
  <h3>Recovery Timer</h3>
  <p id="timer-display">00:00</p>
  <button type="button" id="start-timer-90">Start 90s Timer</button>
  <button type="button" id="start-timer-120">Start 2min Timer</button>
</div>

    </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script>
    // Service Worker registration logic
    if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js').then((registration) => {
    registration.onupdatefound = () => {
      const newWorker = registration.installing;

      newWorker.onstatechange = () => {
        if (newWorker.state === 'installed') {
          if (navigator.serviceWorker.controller) {
            // A new service worker is available, show a notification to the user
            console.log("New update available. Please refresh.");
            alert("A new version of the app is available. Please refresh the page to update.");
          } else {
            // The page is being loaded for the first time
            console.log("App is ready to work offline.");
          }
        }
      };
    };
  });
}

    const form = document.getElementById('exercise-form');
    const table = document.getElementById('exercise-table').getElementsByTagName('tbody')[0];
    const exportBtn = document.getElementById('export-btn');
    const exportTxtBtn = document.getElementById('export-txt-btn');
    const splitContainer = document.getElementById('split-container');
    const addSetBtn = document.getElementById('add-set');
    const setsContainer = document.getElementById('sets-container');
    const exerciseSelect = document.getElementById('exercise');
    const customExerciseInput = document.getElementById('custom-exercise');
    let exercises = JSON.parse(localStorage.getItem('exercises')) || [];

    document.getElementById('date').valueAsDate = new Date();
    document.getElementById('start-time').value = new Date().toTimeString().slice(0, 5);

    // Add event listener for exercise selection change
    exerciseSelect.addEventListener('change', function () {
      if (this.value === 'other') {
        customExerciseInput.classList.remove('hidden');
        customExerciseInput.required = true;
      } else {
        customExerciseInput.classList.add('hidden');
        customExerciseInput.required = false;
      }
    });

    addSetBtn.addEventListener('click', addSet);

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      // Get the checked checkboxes for "Today's Split"
    const selectedSplit = [];
    const checkboxes = splitContainer.querySelectorAll('input[name="split"]:checked');
    checkboxes.forEach((checkbox) => {
        selectedSplit.push(checkbox.value);
    });
      const exerciseName = exerciseSelect.value === 'other' ? customExerciseInput.value : exerciseSelect.value;
      const exercise = {
        date: document.getElementById('date').value,
        startTime: document.getElementById('start-time').value,
        endTime: document.getElementById('end-time').value,
        split: selectedSplit,
        name: exerciseName,
        sets: Array.from(setsContainer.getElementsByClassName('set-container')).map((container, index) => ({
          setNumber: index + 1,
          weight: container.getElementsByClassName('weight')[0].value,
          reps: container.getElementsByClassName('reps')[0].value,
          notes: container.getElementsByClassName('notes')[0].value,
          superset: container.querySelector('.superset-container') ? {
            exercise: container.querySelector('.superset-exercise').value,
            weight: container.querySelector('.superset-weight').value,
            reps: container.querySelector('.superset-reps').value,
            notes: container.querySelector('.superset-notes').value
          } : null
        }))
      };
      exercises.push(exercise);
      localStorage.setItem('exercises', JSON.stringify(exercises));
      renderExercises();
      form.reset();
      document.getElementById('date').valueAsDate = new Date();
      document.getElementById('start-time').value = new Date().toTimeString().slice(0, 5);
      setsContainer.innerHTML = '';
      addSet();
      customExerciseInput.classList.add('hidden');
    });
    function getLastEnteredWeight() {
    const weightInputs = setsContainer.getElementsByClassName('weight');
    return weightInputs.length > 0 ? weightInputs[weightInputs.length - 1].value : '';
}
    function addSet() {
      const setNumber = setsContainer.children.length + 1;
      const lastWeight = getLastEnteredWeight();
      const setDiv = document.createElement('div');
      setDiv.className = 'set-container';
      setDiv.innerHTML = `
        <input type="number" class="weight" placeholder="Weight for Set ${setNumber} (lbs)" value="${lastWeight}" step="0.01" required>
        <input type="number" class="reps" placeholder="Reps for Set ${setNumber}" required>
        <input type="text" class="notes" placeholder="Notes for Set ${setNumber}">
        <button type="button" class="remove-set" onclick="removeSet(this)">Remove</button>
        <button type="button" class="add-superset" onclick="addSuperset(this)">Add Superset</button>
      `;
      setsContainer.appendChild(setDiv);
    }

    function addSuperset(button) {
      const setContainer = button.parentElement;
      const supersetDiv = document.createElement('div');
      supersetDiv.className = 'superset-container';
      supersetDiv.innerHTML = `
        <input type="text" class="superset-exercise" placeholder="Superset Exercise" required>
        <input type="number" class="superset-weight" placeholder="Weight (lbs)" step="0.01" required>
        <input type="number" class="superset-reps" placeholder="Reps" required>
        <input type="text" class="superset-notes" placeholder="Notes">
        <button type="button" class="remove-superset" onclick="removeSuperset(this)">Remove Superset</button>
      `;
      setContainer.appendChild(supersetDiv);
      button.style.display = 'none';
    }

    function removeSuperset(button) {
      const supersetDiv = button.parentElement;
      const setContainer = supersetDiv.parentElement;
      supersetDiv.remove();
      setContainer.querySelector('.add-superset').style.display = 'inline-block';
    }

    function removeSet(button) {
      if (setsContainer.children.length > 1) {
        button.parentElement.remove();
        updateSetNumbers();
      }
    }

    function updateSetNumbers() {
      const setContainers = setsContainer.getElementsByClassName('set-container');
      for (let i = 0; i < setContainers.length; i++) {
        const weightInput = setContainers[i].getElementsByClassName('weight')[0];
        const repsInput = setContainers[i].getElementsByClassName('reps')[0];
        const notesInput = setContainers[i].getElementsByClassName('notes')[0];
        weightInput.placeholder = `Weight for Set ${i + 1} (lbs)`;
        repsInput.placeholder = `Reps for Set ${i + 1}`;
        notesInput.placeholder = `Notes for Set ${i + 1}`;
      }
    }

    function getFormattedDate() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function renderExercises() {
      table.innerHTML = '';
      exercises.forEach((exercise, index) => {
        const row = table.insertRow();
        row.innerHTML = `
          <td>${exercise.date}</td>
          <td>${exercise.startTime}</td>
          <td>${exercise.endTime}</td>
          <td>${exercise.name}</td>
          <td>${exercise.sets.map(set => `
            Set ${set.setNumber}: ${set.weight}lbs x ${set.reps} reps${set.notes ? ` (${set.notes})` : ''}
            ${set.superset ? `<br>Superset: ${set.superset.exercise} - ${set.superset.weight}lbs x ${set.superset.reps} reps${set.superset.notes ? ` (${set.superset.notes})` : ''}` : ''}
          `).join('<br>')}</td>
          <td>
            <button onclick="editExercise(${index})">Edit</button>
            <button onclick="deleteExercise(${index})">Delete</button>
          </td>
        `;
      });
    }

    function editExercise(index) {
      const exercise = exercises[index];
      document.getElementById('date').value = exercise.date;
      document.getElementById('start-time').value = exercise.startTime;
      document.getElementById('end-time').value = exercise.endTime;
      if (exerciseSelect.querySelector(`option[value="${exercise.name}"]`)) {
        exerciseSelect.value = exercise.name;
        customExerciseInput.style.display = 'none';
      } else {
        exerciseSelect.value = 'other';
        customExerciseInput.value = exercise.name;
        customExerciseInput.style.display = 'block';
      }
      setsContainer.innerHTML = '';
      exercise.sets.forEach(set => {
        addSet();
        const lastSet = setsContainer.lastChild;
        lastSet.getElementsByClassName('weight')[0].value = set.weight;
        lastSet.getElementsByClassName('reps')[0].value = set.reps;
        lastSet.getElementsByClassName('notes')[0].value = set.notes || '';
        if (set.superset) {
          addSuperset(lastSet.querySelector('.add-superset'));
          const supersetContainer = lastSet.querySelector('.superset-container');
          supersetContainer.querySelector('.superset-exercise').value = set.superset.exercise;
          supersetContainer.querySelector('.superset-weight').value = set.superset.weight;
          supersetContainer.querySelector('.superset-reps').value = set.superset.reps;
          supersetContainer.querySelector('.superset-notes').value = set.superset.notes || '';
        }
      });
      exercises.splice(index, 1);
      localStorage.setItem('exercises', JSON.stringify(exercises));
      renderExercises();
    }

    function deleteExercise(index) {
      if (confirm('Are you sure you want to delete this exercise?')) {
        exercises.splice(index, 1);
        localStorage.setItem('exercises', JSON.stringify(exercises));
        renderExercises();
      }
    }

    exportBtn.addEventListener('click', () => {
      const flattenedExercises = exercises.flatMap(exercise => 
        exercise.sets.map(set => ({
          date: exercise.date,
          startTime: exercise.startTime,
          endTime: exercise.endTime,
          split: exercise.split.join(', '),  // Ensuring split is a string for CSV
          name: exercise.name,
          setNumber: set.setNumber,
          weight: set.weight,
          reps: set.reps,
          notes: set.notes || '', // Defaulting to empty string if no notes
          supersetExercise: set.superset ? set.superset.exercise : '',  // Flattening superset fields
          supersetWeight: set.superset ? set.superset.weight : '',
          supersetReps: set.superset ? set.superset.reps : '',
          supersetNotes: set.superset ? set.superset.notes : ''
        }))
      );
      const csv = Papa.unparse(flattenedExercises);

      // Get today's split checkboxes
      const selectedSplit = [];
      const checkboxes = splitContainer.querySelectorAll('input[name="split"]:checked');
      checkboxes.forEach((checkbox) => {
          selectedSplit.push(checkbox.value);
      });

      // Generate filename
      const formattedDate = getFormattedDate();
      const splitInfo = selectedSplit.length ? `_${selectedSplit.join('-')}` : ''; // Append split info to filename
      const fileName = `skazius_strength_data_${formattedDate}${splitInfo}.csv`;

      // Trigger download
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = fileName;
      link.click();
    });

    function generateExerciseLogText() {
      let logText = "EXERCISE LOG\n\n";
      exercises.forEach((exercise, index) => {
        logText += `Date: ${exercise.date}\n`;
        logText += `Start Time: ${exercise.startTime}\n`;
        logText += `End Time: ${exercise.endTime}\n`;
        logText += `Split: ${exercise.split.join(', ')}\n`;
        logText += `Exercise: ${exercise.name}\n`;
        logText += "Sets:\n";
        exercise.sets.forEach(set => {
          logText += `  Set ${set.setNumber}: ${set.weight}lbs x ${set.reps} reps`;
          if (set.notes) logText += ` (${set.notes})`;
          logText += "\n";
          if (set.superset) {
            logText += `    Superset: ${set.superset.exercise} - ${set.superset.weight}lbs x ${set.superset.reps} reps`;
            if (set.superset.notes) logText += ` (${set.superset.notes})`;
            logText += "\n";
          }
        });
        logText += "\n";
      });
      return logText;
    }

    exportTxtBtn.addEventListener('click', () => {
  const logText = generateExerciseLogText();

  // Get today's split checkboxes
  const selectedSplit = [];
  const checkboxes = splitContainer.querySelectorAll('input[name="split"]:checked');
  checkboxes.forEach((checkbox) => {
      selectedSplit.push(checkbox.value);
  });

  // Generate filename
  const formattedDate = getFormattedDate();
  const splitInfo = selectedSplit.length ? `_${selectedSplit.join('-')}` : ''; // Append split info to filename
  const fileName = `skazius_strength_log_${formattedDate}${splitInfo}.txt`;

  // Trigger download
  const blob = new Blob([logText], { type: 'text/plain;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = fileName;
  link.click();
});

    addSetBtn.addEventListener('click', addSet);

    addSet();
    renderExercises();

    document.addEventListener('gesturestart', function(e) {
      e.preventDefault();
    });

    // Clear All functionality
const clearAllBtn = document.getElementById('clear-all-btn');
clearAllBtn.addEventListener('click', () => {
  if (confirm('Are you sure you want to clear all exercises? This action cannot be undone.')) {
    exercises = [];
    localStorage.setItem('exercises', JSON.stringify(exercises));
    renderExercises();
  }
});
    let timerInterval;

function startTimer(duration) {
  clearInterval(timerInterval); // Clear any existing timer
  let time = duration;
  const timerDisplay = document.getElementById('timer-display');
  
  timerInterval = setInterval(() => {
    const minutes = Math.floor(time / 60);
    const seconds = time % 60;
    timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    
    if (time === 0) {
      clearInterval(timerInterval);
      alert("Time's up! Get ready for the next set.");
    }
    
    time--;
  }, 1000);
}

// Event listeners for the buttons
document.getElementById('start-timer-90').addEventListener('click', () => startTimer(90));
document.getElementById('start-timer-120').addEventListener('click', () => startTimer(120));


  </script>
</body>
</html>
